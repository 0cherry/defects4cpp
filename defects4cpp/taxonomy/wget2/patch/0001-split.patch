From f31ef3847ce88c280fa478f91c400df0b534f7e5 Mon Sep 17 00:00:00 2001
From: hakumaku <gentlebuuny@gmail.com>
Date: Mon, 13 Sep 2021 13:49:26 +0900
Subject: [PATCH] split tests

---
 defects4cpp.h                                | 11 +++++++++++
 defects4cpp.lua                              |  1 +
 tests/test--accept.c                         |  5 +++++
 tests/test--filter-mime-type.c               |  5 +++++
 tests/test--follow-tags.c                    |  5 +++++
 tests/test--https-enforce-hard1.c            |  5 +++++
 tests/test--https-enforce-hard2.c            |  5 +++++
 tests/test--https-enforce-hard3.c            |  5 +++++
 tests/test--https-enforce-soft1.c            |  5 +++++
 tests/test--https-enforce-soft2.c            |  5 +++++
 tests/test--https-enforce-soft3.c            |  5 +++++
 tests/test--page-requisites.c                |  5 +++++
 tests/test--save-content-on.c                |  5 +++++
 tests/test--spider-r.c                       |  5 +++++
 tests/test-E-k.c                             |  5 +++++
 tests/test-auth-basic.c                      |  5 +++++
 tests/test-auth-digest.c                     |  5 +++++
 tests/test-bad-chunk.c                       |  5 +++++
 tests/test-base.c                            |  5 +++++
 tests/test-c-r.c                             |  5 +++++
 tests/test-chunked.c                         |  6 ++++++
 tests/test-compression.c                     |  5 +++++
 tests/test-convert-file-only.c               |  5 +++++
 tests/test-cookies.c                         |  5 +++++
 tests/test-cut-dirs.c                        |  5 +++++
 tests/test-directory-clash.c                 |  5 +++++
 tests/test-gzip.c                            |  5 +++++
 tests/test-i-http.c                          |  5 +++++
 tests/test-i-https.c                         |  5 +++++
 tests/test-idn-cmd.c                         |  5 +++++
 tests/test-idn-meta.c                        |  5 +++++
 tests/test-idn-robots.c                      |  5 +++++
 tests/test-ignore-length.c                   |  5 +++++
 tests/test-include-and-exclude-directories.c |  5 +++++
 tests/test-iri-forced-remote.c               |  5 +++++
 tests/test-iri-list.c                        |  5 +++++
 tests/test-iri-percent.c                     |  5 +++++
 tests/test-iri-subdir.c                      |  5 +++++
 tests/test-iri.c                             |  5 +++++
 tests/test-k.c                               |  5 +++++
 tests/test-limit-rate-http2.c                |  5 +++++
 tests/test-limit-rate.c                      |  5 +++++
 tests/test-meta-robots.c                     |  5 +++++
 tests/test-metalink.c                        |  5 +++++
 tests/test-np.c                              |  5 +++++
 tests/test-ocsp-server.c                     |  5 +++++
 tests/test-ocsp-stap.c                       |  5 +++++
 tests/test-p-nc.c                            |  5 +++++
 tests/test-parse-css.c                       |  5 +++++
 tests/test-parse-html-css.c                  |  5 +++++
 tests/test-parse-rss.c                       |  5 +++++
 tests/test-plugin-failure.c                  |  5 +++++
 tests/test-plugin-interception.c             |  5 +++++
 tests/test-plugin-nonexistance.c             |  5 +++++
 tests/test-plugin.c                          |  5 +++++
 tests/test-post-handshake-auth.c             |  5 +++++
 tests/test-redirection.c                     |  5 +++++
 tests/test-restrict-ascii.c                  |  5 +++++
 tests/test-robots-off.c                      |  5 +++++
 tests/test-robots.c                          |  5 +++++
 tests/test-stats-dns.c                       |  5 +++++
 tests/test-stats-ocsp.c                      |  5 +++++
 tests/test-stats-site.c                      |  5 +++++
 tests/test-stats-tls.c                       |  5 +++++
 tests/test-timestamping.c                    |  5 +++++
 tests/test-unlink.c                          |  5 +++++
 tests/test-wget-1.c                          |  5 +++++
 unit-tests/test-cond.c                       |  5 +++++
 unit-tests/test-decompress.c                 |  6 ++++++
 unit-tests/test-dl.c                         |  6 ++++++
 unit-tests/test-parse-html.c                 |  5 +++++
 unit-tests/test.c                            |  6 ++++++
 72 files changed, 366 insertions(+)
 create mode 100644 defects4cpp.h
 create mode 100644 defects4cpp.lua

diff --git a/defects4cpp.h b/defects4cpp.h
new file mode 100644
index 00000000..339801ed
--- /dev/null
+++ b/defects4cpp.h
@@ -0,0 +1,11 @@
+#include <lua5.3/lualib.h>
+#include <lua5.3/lauxlib.h>
+
+static int defects4cpp_test_index() {
+  lua_State *L = luaL_newstate();
+  luaL_openlibs(L);
+  luaL_dofile(L, "../defects4cpp.lua");
+  int ret = lua_tonumber(L, -1);
+  lua_close(L);
+  return ret;
+}
diff --git a/defects4cpp.lua b/defects4cpp.lua
new file mode 100644
index 00000000..a4325f62
--- /dev/null
+++ b/defects4cpp.lua
@@ -0,0 +1 @@
+return 1
diff --git a/tests/test--accept.c b/tests/test--accept.c
index 0955092e..345aa5ad 100644
--- a/tests/test--accept.c
+++ b/tests/test--accept.c
@@ -30,6 +30,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -85,6 +86,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 1:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -402,6 +405,8 @@ int main(void)
 			{ urls[6].name + 1, "anycontent", 1097310600 },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--filter-mime-type.c b/tests/test--filter-mime-type.c
index bc6895d0..1f596ce9 100644
--- a/tests/test--filter-mime-type.c
+++ b/tests/test--filter-mime-type.c
@@ -22,6 +22,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -81,6 +82,8 @@ int main(void)
                 }
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 2:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -236,6 +239,8 @@ int main(void)
 			{ urls[6].name + 1, urls[6].body, 1097310600 },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--follow-tags.c b/tests/test--follow-tags.c
index 4432dc1c..6eda9190 100644
--- a/tests/test--follow-tags.c
+++ b/tests/test--follow-tags.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -76,6 +77,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 3:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -210,6 +213,8 @@ int main(void)
 			{ urls[4].name + 1, urls[4].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--https-enforce-hard1.c b/tests/test--https-enforce-hard1.c
index fda545ae..0a8d30a4 100644
--- a/tests/test--https-enforce-hard1.c
+++ b/tests/test--https-enforce-hard1.c
@@ -21,6 +21,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -43,6 +44,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 4:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -60,6 +63,8 @@ int main(void)
 			{ urls[0].name + 1, urls[0].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--https-enforce-hard2.c b/tests/test--https-enforce-hard2.c
index cc6658b6..3cbd0b96 100644
--- a/tests/test--https-enforce-hard2.c
+++ b/tests/test--https-enforce-hard2.c
@@ -21,6 +21,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -34,6 +35,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 5:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -51,6 +54,8 @@ int main(void)
 		WGET_TEST_EXPECTED_ERROR_CODE2, 5, // TLS handshake error
 		WGET_TEST_EXPECTED_ERROR_CODE,  4, // network error
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--https-enforce-hard3.c b/tests/test--https-enforce-hard3.c
index df908e4c..7b2a5181 100644
--- a/tests/test--https-enforce-hard3.c
+++ b/tests/test--https-enforce-hard3.c
@@ -22,6 +22,7 @@
 #include <stdlib.h> // exit()
 #include <microhttpd.h>
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -45,6 +46,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 6:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -74,6 +77,8 @@ int main(void)
 			{ urls[1].name + 1, urls[1].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--https-enforce-soft1.c b/tests/test--https-enforce-soft1.c
index 5ab7baf1..8feeee78 100644
--- a/tests/test--https-enforce-soft1.c
+++ b/tests/test--https-enforce-soft1.c
@@ -21,6 +21,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -43,6 +44,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 7:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -63,6 +66,8 @@ int main(void)
 			{ urls[1].name + 1, urls[1].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--https-enforce-soft2.c b/tests/test--https-enforce-soft2.c
index 59fbe617..ac0b5d03 100644
--- a/tests/test--https-enforce-soft2.c
+++ b/tests/test--https-enforce-soft2.c
@@ -22,6 +22,7 @@
 #include <stdlib.h> // exit()
 #include <microhttpd.h>
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -53,6 +54,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 8:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -84,6 +87,8 @@ int main(void)
 			{ urls[2].name + 1, urls[2].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--https-enforce-soft3.c b/tests/test--https-enforce-soft3.c
index 5c27d13d..289b74ec 100644
--- a/tests/test--https-enforce-soft3.c
+++ b/tests/test--https-enforce-soft3.c
@@ -21,6 +21,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -52,6 +53,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 9:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -76,6 +79,8 @@ int main(void)
 			{ urls[2].name + 1, urls[2].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--page-requisites.c b/tests/test--page-requisites.c
index eb384ee3..f5f3832b 100644
--- a/tests/test--page-requisites.c
+++ b/tests/test--page-requisites.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -186,6 +187,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 10:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -235,6 +238,8 @@ int main(void)
 			{ urls[16].name + 1, urls[16].body }, // background.css
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--save-content-on.c b/tests/test--save-content-on.c
index b14cb8d1..67ab14d3 100644
--- a/tests/test--save-content-on.c
+++ b/tests/test--save-content-on.c
@@ -22,6 +22,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -75,6 +76,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 11:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -116,6 +119,8 @@ int main(void)
 			{ "robots.txt", "" },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test--spider-r.c b/tests/test--spider-r.c
index 9373c9bc..c5961577 100644
--- a/tests/test--spider-r.c
+++ b/tests/test--spider-r.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -76,6 +77,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 12:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -98,6 +101,8 @@ int main(void)
 		WGET_TEST_REQUEST_URL, "index.html",
 		WGET_TEST_EXPECTED_ERROR_CODE, 8,
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-E-k.c b/tests/test-E-k.c
index 8826169a..979ac086 100644
--- a/tests/test-E-k.c
+++ b/tests/test-E-k.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -57,6 +58,8 @@ int main(void)
 		" <a href=\"subpage.php.html\">second page</a>." \
 		"</p></body></html>";
 
+    switch (defects4cpp_test_index()) {
+        case 13:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -87,6 +90,8 @@ int main(void)
 			{	NULL } },
 		0);
 */
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-auth-basic.c b/tests/test-auth-basic.c
index eb74e8e5..561b3bae 100644
--- a/tests/test-auth-basic.c
+++ b/tests/test-auth-basic.c
@@ -30,6 +30,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strlen()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #define username "my_username"
 #define password "my_password"
@@ -53,6 +54,8 @@ int main(void)
 		.content = "default\r\nlogin " username "\r\npassword " password "\r\n"
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 14:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -185,6 +188,8 @@ int main(void)
 		WGET_TEST_EXPECTED_FILES, &(wget_test_file_t []) {
 			{ NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-auth-digest.c b/tests/test-auth-digest.c
index 913a936d..f6dfe0c2 100644
--- a/tests/test-auth-digest.c
+++ b/tests/test-auth-digest.c
@@ -29,6 +29,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strlen()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #define username "my_username"
 #define password "my_password"
@@ -52,6 +53,8 @@ int main(void)
 		.content = "default\r\nlogin " username "\r\npassword " password "\r\n"
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 15:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -164,6 +167,8 @@ int main(void)
 		WGET_TEST_EXPECTED_FILES, &(wget_test_file_t []) {
 			{ NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-bad-chunk.c b/tests/test-bad-chunk.c
index c7012e5b..7787e5f4 100644
--- a/tests/test-bad-chunk.c
+++ b/tests/test-bad-chunk.c
@@ -25,6 +25,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -55,6 +56,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 16:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -73,6 +76,8 @@ int main(void)
 			{ urls[2].name + 1, NULL }, // do not check content
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-base.c b/tests/test-base.c
index ff13dd54..4bc86edd 100644
--- a/tests/test-base.c
+++ b/tests/test-base.c
@@ -25,6 +25,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -100,6 +101,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 17:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -145,6 +148,8 @@ int main(void)
 			{ urls[5].name + 1, urls[5].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-c-r.c b/tests/test-c-r.c
index 582ce8af..d6e076d1 100644
--- a/tests/test-c-r.c
+++ b/tests/test-c-r.c
@@ -26,6 +26,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strlen()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 static const char *mainpage = "\
 <html>\n\
@@ -94,6 +95,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 18:
 	wget_test_start_server(
 			WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
 			WGET_TEST_FEATURE_MHD,
@@ -140,6 +143,8 @@ int main(void)
 			{ "thirdpage.html", urls[2].body },
 			{	NULL } },
 		0);
+        break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-chunked.c b/tests/test-chunked.c
index 43f5a604..a3ea30cf 100644
--- a/tests/test-chunked.c
+++ b/tests/test-chunked.c
@@ -25,6 +25,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -39,6 +40,9 @@ int main(void)
 		},
 	};
 
+    int index = defects4cpp_test_index();
+    switch (index) {
+        case 19:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -56,5 +60,7 @@ int main(void)
 			{	NULL } },
 		0);
 
+            break;
+    }
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-compression.c b/tests/test-compression.c
index e939b225..a62a71e5 100644
--- a/tests/test-compression.c
+++ b/tests/test-compression.c
@@ -21,6 +21,7 @@
 #include <string.h>
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #define uncompressed_body "x"
 
@@ -263,6 +264,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 20:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -404,6 +407,8 @@ int main(void)
         WGET_TEST_REQUEST_URL, urls[10].name + 1,
         WGET_TEST_EXPECTED_ERROR_CODE, 2,
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-convert-file-only.c b/tests/test-convert-file-only.c
index 1ce89aad..b8aad179 100644
--- a/tests/test-convert-file-only.c
+++ b/tests/test-convert-file-only.c
@@ -25,6 +25,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -78,6 +79,8 @@ int main(void)
 		" <a href=\"/subdir/page7.html\">page7</a>." \
 		"</p></body></html>";
 
+    switch (defects4cpp_test_index()) {
+        case 21:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -98,6 +101,8 @@ int main(void)
 			{ "subdir/page7.html", urls[3].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-cookies.c b/tests/test-cookies.c
index c2415ebf..60fe2171 100644
--- a/tests/test-cookies.c
+++ b/tests/test-cookies.c
@@ -25,6 +25,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #ifndef _WIN32
 static const char cookie_jar_data[] =
@@ -91,6 +92,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 22:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -172,6 +175,8 @@ int main(void)
 			{ "cookie.jar", cookie_jar_data2 },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-cut-dirs.c b/tests/test-cut-dirs.c
index ada204f0..1e805d2d 100644
--- a/tests/test-cut-dirs.c
+++ b/tests/test-cut-dirs.c
@@ -26,6 +26,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -50,6 +51,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 23:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -121,6 +124,8 @@ int main(void)
 			{ urls[1].name + 1, urls[1].body },
 			{ NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-directory-clash.c b/tests/test-directory-clash.c
index 5b043a21..7bb6055f 100644
--- a/tests/test-directory-clash.c
+++ b/tests/test-directory-clash.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -75,6 +76,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 24:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -124,6 +127,8 @@ int main(void)
 			// { "subdir.1", urls[2].body, 0 }, // file not saved since it already exists as directory and --no-clobber is given
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-gzip.c b/tests/test-gzip.c
index 5ff90a51..1ae9fb90 100644
--- a/tests/test-gzip.c
+++ b/tests/test-gzip.c
@@ -21,6 +21,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 // gzipp'ed content 'x'
 #define compressed_body "\x1f\x8b\x08\x08\x48\x5d\x91\x5a\x00\x03\x78\x00\xab\x00\x00\x83\x16\xdc\x8c\x01\x00\x00\x00"
@@ -69,6 +70,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 25:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -134,6 +137,8 @@ int main(void)
 #endif
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-i-http.c b/tests/test-i-http.c
index a358b25b..67095f78 100644
--- a/tests/test-i-http.c
+++ b/tests/test-i-http.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -56,6 +57,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 26:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -90,5 +93,7 @@ int main(void)
 			{	NULL } },
 		0);
 */
+    break;
+    }
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-i-https.c b/tests/test-i-https.c
index fc3e7bea..e85134ec 100644
--- a/tests/test-i-https.c
+++ b/tests/test-i-https.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -56,6 +57,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 27:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -156,5 +159,7 @@ int main(void)
 			{	NULL } },
 		0);
 */
+    break;
+    }
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-idn-cmd.c b/tests/test-idn-cmd.c
index 020c2b49..ea47b719 100644
--- a/tests/test-idn-cmd.c
+++ b/tests/test-idn-cmd.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 // Kon'nichiwa <dot> Japan
 #define euc_jp_hostname "\272\243\306\374\244\317.\306\374\313\334"
@@ -50,6 +51,8 @@ int main(void)
 	};
 
 	char options[256];
+    switch (defects4cpp_test_index()) {
+        case 28:
 
 	// functions won't come back if an error occurs
 	wget_test_start_server(
@@ -88,6 +91,8 @@ int main(void)
 			{	NULL } },
 		0);
 #endif
+    break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-idn-meta.c b/tests/test-idn-meta.c
index c3564f38..67f83f77 100644
--- a/tests/test-idn-meta.c
+++ b/tests/test-idn-meta.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 // Kon'nichiwa <dot> Japan
 #define euc_jp_hostname "\272\243\306\374\244\317.\306\374\313\334"
@@ -71,6 +72,8 @@ int main(void)
 
 	char options[256];
 
+    switch (defects4cpp_test_index()) {
+        case 29:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -136,6 +139,8 @@ int main(void)
 			{ punycoded_hostname "/index.html", urls[2].body },
 			{	NULL } },
 		0);
+    break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-idn-robots.c b/tests/test-idn-robots.c
index 87b9e041..41b68a8d 100644
--- a/tests/test-idn-robots.c
+++ b/tests/test-idn-robots.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 // Kon'nichiwa <dot> Japan
 #define euc_jp_hostname "\272\243\306\374\244\317.\306\374\313\334"
@@ -65,6 +66,8 @@ int main(void)
 
 	char options[256];
 
+    switch (defects4cpp_test_index()) {
+        case 30:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -109,6 +112,8 @@ int main(void)
 			{	NULL } },
 		0);
 #endif
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-ignore-length.c b/tests/test-ignore-length.c
index 19d0bde4..f4f8fb9f 100644
--- a/tests/test-ignore-length.c
+++ b/tests/test-ignore-length.c
@@ -26,6 +26,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -58,6 +59,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 31:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -75,6 +78,8 @@ int main(void)
 			{ urls[1].name + 1, urls[1].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-include-and-exclude-directories.c b/tests/test-include-and-exclude-directories.c
index f2412e03..a5c091bd 100644
--- a/tests/test-include-and-exclude-directories.c
+++ b/tests/test-include-and-exclude-directories.c
@@ -25,6 +25,7 @@
 #include <stdlib.h> // exit()
 #include <string.h>
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -79,6 +80,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 32:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -226,6 +229,8 @@ int main(void)
 			{ urls[3].name + 1, urls[3].body, 1097310600 },
 			{ NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-iri-forced-remote.c b/tests/test-iri-forced-remote.c
index 45ef895f..47f753c1 100644
--- a/tests/test-iri-forced-remote.c
+++ b/tests/test-iri-forced-remote.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #define ccedilla_l15 "\xE7"
 #define ccedilla_u8 "\xC3\xA7"
@@ -102,6 +103,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 33:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -122,6 +125,8 @@ int main(void)
 			{ "p3_" eurosign_u8 eurosign_u8 eurosign_u8 ".html", urls[5].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-iri-list.c b/tests/test-iri-list.c
index b38851e1..f15e0e52 100644
--- a/tests/test-iri-list.c
+++ b/tests/test-iri-list.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #define ccedilla_l1 "\xE7"
 #define ccedilla_u8 "\xC3\xA7"
@@ -83,6 +84,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 34:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -105,6 +108,8 @@ int main(void)
 			{ "urls.txt", urls[4].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-iri-percent.c b/tests/test-iri-percent.c
index 2daf1b4e..7378f7df 100644
--- a/tests/test-iri-percent.c
+++ b/tests/test-iri-percent.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 // #define ccedilla_l15 "\xE7"
 #define ccedilla_l15_pct "%E7"
@@ -70,6 +71,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 35:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -88,6 +91,8 @@ int main(void)
 			{ urls[2].name + 1, urls[2].body },
 			{	NULL } },
 		0);
+    break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-iri-subdir.c b/tests/test-iri-subdir.c
index ecf9e29a..9955820f 100644
--- a/tests/test-iri-subdir.c
+++ b/tests/test-iri-subdir.c
@@ -27,6 +27,7 @@
 #include <stdlib.h> // exit()
 #include <string.h>
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -74,6 +75,8 @@ int main(void)
 
 		wget_free(dst);
 	}
+    switch (defects4cpp_test_index()) {
+        case 36:
 
 	// functions won't come back if an error occurs
 	wget_test_start_server(
@@ -93,6 +96,8 @@ int main(void)
 			{ "~foo/‾baz.html", urls[2].body }, // unescaped + UTF-8, matching local-encoding
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-iri.c b/tests/test-iri.c
index 0374f4b3..36878a42 100644
--- a/tests/test-iri.c
+++ b/tests/test-iri.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #define ccedilla_l15 "\xE7"
 #define ccedilla_u8 "\xC3\xA7"
@@ -131,6 +132,8 @@ int main(void)
 
 	char request_header[256];
 
+    switch (defects4cpp_test_index()) {
+        case 37:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -156,6 +159,8 @@ int main(void)
 			{ "p4_m" eacute_u8 eacute_u8 "r.html", urls[7].body, 0, WGET_RESTRICT_NAMES_NOCONTROL },
 			{	NULL } },
 		0);
+    break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-k.c b/tests/test-k.c
index af519f95..e41e149b 100644
--- a/tests/test-k.c
+++ b/tests/test-k.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -78,6 +79,8 @@ int main(void)
 		" <SCRIPT LANGUAGE=\"JavaScript\">document.write(\"<img src=\\\"rw1\\\"\");</SCRIPT>" \
 		"</p></body></html>";
 
+    switch (defects4cpp_test_index()) {
+        case 38:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -96,6 +99,8 @@ int main(void)
 			{ urls[2].name + 1, urls[2].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-limit-rate-http2.c b/tests/test-limit-rate-http2.c
index 0ddf82fd..ba7c6c85 100644
--- a/tests/test-limit-rate-http2.c
+++ b/tests/test-limit-rate-http2.c
@@ -25,6 +25,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strcmp()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #define WITHIN_RANGE(value, desired, tolerance) \
   ((value <= desired + tolerance) && (value >= desired - tolerance))
@@ -90,6 +91,8 @@ int main(void)
 
 	const char *valgrind = getenv("VALGRIND_TESTS");
 
+    switch (defects4cpp_test_index()) {
+        case 39:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -223,6 +226,8 @@ int main(void)
 		                       "(elapsed=%lld ms, desired=%lld±%lld ms)\n",
 		                       elapsed_ms, desired_ms, tolerance_ms);
 	}
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-limit-rate.c b/tests/test-limit-rate.c
index 844c1012..0b734116 100644
--- a/tests/test-limit-rate.c
+++ b/tests/test-limit-rate.c
@@ -25,6 +25,7 @@
 #include <stdlib.h> // exit()
 #include <string.h>
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #define WITHIN_RANGE(value, desired, tolerance) \
   ((value <= desired + tolerance) && (value >= desired - tolerance))
@@ -90,6 +91,8 @@ int main(void)
 
 	const char *valgrind = getenv("VALGRIND_TESTS");
 
+    switch (defects4cpp_test_index()) {
+        case 40:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -223,6 +226,8 @@ int main(void)
 		                       "(elapsed=%lld ms, desired=%lld±%lld ms)\n",
 		                       elapsed_ms, desired_ms, tolerance_ms);
 	}
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-meta-robots.c b/tests/test-meta-robots.c
index 9282781f..743a130a 100644
--- a/tests/test-meta-robots.c
+++ b/tests/test-meta-robots.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -110,6 +111,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 41:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -132,6 +135,8 @@ int main(void)
 			{ urls[8].name + 1, urls[8].body },
 			{	NULL } },
 		0);
+    break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-metalink.c b/tests/test-metalink.c
index 81e13b26..c19c23c0 100644
--- a/tests/test-metalink.c
+++ b/tests/test-metalink.c
@@ -30,6 +30,7 @@
 #include <stdlib.h> // exit()
 #include <string.h>
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -125,6 +126,8 @@ int main(void)
 	unsigned char digest[hashlen];
 	char *body0, *body2, *body4, *body7; // to be freed later
 
+    switch (defects4cpp_test_index()) {
+        case 42:
 	wget_hash_printf_hex(WGET_DIGTYPE_MD5, md5hex, sizeof(md5hex), "%s", urls[1].body);
 	urls[0].body = body0 = wget_aprintf(
 		"<?xml version=\"1.0\" encoding=\"utf-8\"?>"
@@ -306,6 +309,8 @@ int main(void)
 	wget_free(body7);
 	wget_free((void *)urls[6].headers[4]);
 	wget_free((void *)urls[9].headers[3]);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-np.c b/tests/test-np.c
index a040c26c..5ab5c099 100644
--- a/tests/test-np.c
+++ b/tests/test-np.c
@@ -29,6 +29,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -89,6 +90,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 43:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -106,6 +109,8 @@ int main(void)
 			{ urls[2].name + 1, urls[2].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-ocsp-server.c b/tests/test-ocsp-server.c
index 9114382e..3d018ae9 100644
--- a/tests/test-ocsp-server.c
+++ b/tests/test-ocsp-server.c
@@ -20,6 +20,7 @@
 #include <config.h>
 
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -33,6 +34,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 44:
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
 		WGET_TEST_FEATURE_MHD,
@@ -80,6 +83,8 @@ int main(void)
 			{urls[0].name + 1, urls[0].body},
 			{	NULL} },
 		0);
+    break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-ocsp-stap.c b/tests/test-ocsp-stap.c
index 02230094..4a5dbfa5 100644
--- a/tests/test-ocsp-stap.c
+++ b/tests/test-ocsp-stap.c
@@ -20,6 +20,7 @@
 #include <config.h>
 
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -33,6 +34,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 45:
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
 		WGET_TEST_FEATURE_MHD,
@@ -49,6 +52,8 @@ int main(void)
 			{urls[0].name + 1, urls[0].body},
 			{	NULL} },
 		0);
+        break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-p-nc.c b/tests/test-p-nc.c
index 5dce7483..eed23c83 100644
--- a/tests/test-p-nc.c
+++ b/tests/test-p-nc.c
@@ -33,6 +33,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -196,6 +197,8 @@ int main(void)
 				" Hey, a srcset <img srcset=\"picture1.png, picture2.png 150w,picture3.png 100x\"/>." \
 			"</p></body></html>";
 
+    switch (defects4cpp_test_index()) {
+        case 46:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -240,6 +243,8 @@ int main(void)
 			{ urls[7].name + 1, urls[7].body },
 			{	NULL }},
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-parse-css.c b/tests/test-parse-css.c
index 0e887ac2..b9bb6b31 100644
--- a/tests/test-parse-css.c
+++ b/tests/test-parse-css.c
@@ -26,6 +26,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strlen()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -74,6 +75,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 47:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -114,6 +117,8 @@ int main(void)
 			{ urls[4].name + 1, urls[4].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-parse-html-css.c b/tests/test-parse-html-css.c
index e6994ed4..21b21b10 100644
--- a/tests/test-parse-html-css.c
+++ b/tests/test-parse-html-css.c
@@ -25,6 +25,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strlen()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -67,6 +68,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 48:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -105,6 +108,8 @@ int main(void)
 			{ urls[3].name + 1, urls[3].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-parse-rss.c b/tests/test-parse-rss.c
index 504fcd8a..0ddbab6a 100644
--- a/tests/test-parse-rss.c
+++ b/tests/test-parse-rss.c
@@ -30,6 +30,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strlen()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -72,6 +73,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 49:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -94,6 +97,8 @@ int main(void)
 			{ urls[3].name + 1, urls[3].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-plugin-failure.c b/tests/test-plugin-failure.c
index 8346c17e..01749295 100644
--- a/tests/test-plugin-failure.c
+++ b/tests/test-plugin-failure.c
@@ -28,6 +28,7 @@
 #include <unistd.h> // access()
 #include "libtest.h"
 #include "plugin_tests.h"
+#include "../defects4cpp.h"
 
 // #define LARGEFILE (11 << 20)
 
@@ -179,6 +180,8 @@ int main(void)
 		&& access(".libs/cygpluginname.dll", R_OK) != 0)
 		exit(WGET_TEST_EXIT_SKIP); // likely a static build
 
+    switch (defects4cpp_test_index()) {
+        case 50:
 	wget_test_start_server(
 			WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
 			WGET_TEST_FEATURE_MHD,
@@ -270,6 +273,8 @@ int main(void)
 		WGET_TEST_REQUEST_URL, "index.html",
 		WGET_TEST_EXPECTED_ERROR_CODE, 2,
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-plugin-interception.c b/tests/test-plugin-interception.c
index e6509676..96545959 100644
--- a/tests/test-plugin-interception.c
+++ b/tests/test-plugin-interception.c
@@ -28,6 +28,7 @@
 #include <unistd.h> // access()
 #include "libtest.h"
 #include "plugin_tests.h"
+#include "../defects4cpp.h"
 
 // #define LARGEFILE (11 << 20)
 
@@ -182,6 +183,8 @@ int main(void)
 	    && access(".libs/cygpluginname.dll", R_OK) != 0)
 		exit(WGET_TEST_EXIT_SKIP); // likely a static build
 
+    switch (defects4cpp_test_index()) {
+        case 51:
 	wget_test_start_server(
 			WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
 			WGET_TEST_FEATURE_MHD,
@@ -384,6 +387,8 @@ int main(void)
 			{	NULL } },
 		0);
 #endif
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-plugin-nonexistance.c b/tests/test-plugin-nonexistance.c
index c0c3c3e9..2779ab22 100644
--- a/tests/test-plugin-nonexistance.c
+++ b/tests/test-plugin-nonexistance.c
@@ -27,6 +27,7 @@
 #include <unistd.h> // access()
 #include "libtest.h"
 #include "plugin_tests.h"
+#include "../defects4cpp.h"
 
 static const char *mainpage = "\
 <html>\n\
@@ -176,6 +177,8 @@ int main(void)
 		&& access(".libs/cygpluginname.dll", R_OK) != 0)
 		exit(WGET_TEST_EXIT_SKIP); // likely a static build
 
+    switch (defects4cpp_test_index()) {
+        case 52:
 	wget_test_start_server(
 			WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
 			WGET_TEST_FEATURE_MHD,
@@ -226,6 +229,8 @@ int main(void)
 		WGET_TEST_EXPECTED_FILES, &(wget_test_file_t []) {
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 
diff --git a/tests/test-plugin.c b/tests/test-plugin.c
index 5ee157da..74d7eb04 100644
--- a/tests/test-plugin.c
+++ b/tests/test-plugin.c
@@ -28,6 +28,7 @@
 #include <unistd.h> // access()
 #include "libtest.h"
 #include "plugin_tests.h"
+#include "../defects4cpp.h"
 
 // #define LARGEFILE (11 << 20)
 
@@ -179,6 +180,8 @@ int main(void)
 		&& access(".libs/cygpluginname.dll", R_OK) != 0)
 		exit(WGET_TEST_EXIT_SKIP); // likely a static build
 
+    switch (defects4cpp_test_index()) {
+        case 53:
 	wget_test_start_server(
 			WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
 			WGET_TEST_FEATURE_MHD,
@@ -351,6 +354,8 @@ int main(void)
 			{ "ocsp.db", NULL },
 			{ NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-post-handshake-auth.c b/tests/test-post-handshake-auth.c
index 199d82e2..3f9e5177 100644
--- a/tests/test-post-handshake-auth.c
+++ b/tests/test-post-handshake-auth.c
@@ -27,6 +27,7 @@
 #include <stdlib.h>
 
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 #ifdef WITH_GNUTLS
 #  include <gnutls/gnutls.h>
@@ -51,6 +52,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 54:
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
 		WGET_TEST_FEATURE_MHD,
@@ -69,4 +72,6 @@ int main(void)
 
 	exit(EXIT_SUCCESS);
 #endif
+    break;
+    }
 }
diff --git a/tests/test-redirection.c b/tests/test-redirection.c
index bbaea1b3..3030a5f2 100644
--- a/tests/test-redirection.c
+++ b/tests/test-redirection.c
@@ -28,6 +28,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -90,6 +91,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 55:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -132,6 +135,8 @@ int main(void)
 	//for a POST request:
 	//	upon receiving 301 response code, redirection request must be GET request
 	//	upon receiving 307 response code, redirection request can be POST request
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-restrict-ascii.c b/tests/test-restrict-ascii.c
index 2c899fb6..4f3ffed6 100644
--- a/tests/test-restrict-ascii.c
+++ b/tests/test-restrict-ascii.c
@@ -30,6 +30,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strlen()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 static const char *mainpage = "\
 <html>\n\
@@ -56,6 +57,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 56:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -85,5 +88,7 @@ int main(void)
 			{	NULL } },
 		0);
 */
+    break;
+    }
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-robots-off.c b/tests/test-robots-off.c
index 43c514e9..211ded26 100644
--- a/tests/test-robots-off.c
+++ b/tests/test-robots-off.c
@@ -25,6 +25,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -85,6 +86,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 57:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -106,6 +109,8 @@ int main(void)
 			{ urls[6].name + 1, urls[6].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-robots.c b/tests/test-robots.c
index e2797ff3..7b979cc5 100644
--- a/tests/test-robots.c
+++ b/tests/test-robots.c
@@ -25,6 +25,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -95,6 +96,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 58:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -166,6 +169,8 @@ int main(void)
 			{ urls[6].name + 1, urls[6].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-stats-dns.c b/tests/test-stats-dns.c
index d0326b11..95c72f9a 100644
--- a/tests/test-stats-dns.c
+++ b/tests/test-stats-dns.c
@@ -24,9 +24,14 @@
 
 #include "stats-test-util.h" // run_stats_test_with_option()
 #include <stdlib.h> // exit()
+#include "../defects4cpp.h" // run_stats_test_with_option()
 
 int main(void)
 {
+    switch (defects4cpp_test_index()) {
+        case 59:
 	run_stats_test_with_option("--stats-dns");
+            break;
+    }
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-stats-ocsp.c b/tests/test-stats-ocsp.c
index f443f90b..b74a354d 100644
--- a/tests/test-stats-ocsp.c
+++ b/tests/test-stats-ocsp.c
@@ -24,9 +24,14 @@
 
 #include "stats-test-util.h" // run_stats_test_with_option()
 #include <stdlib.h> // exit()
+#include "../defects4cpp.h"
 
 int main(void)
 {
+    switch (defects4cpp_test_index()) {
+        case 60:
 	run_stats_test_with_option("--stats-ocsp");
+            break;
+    }
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-stats-site.c b/tests/test-stats-site.c
index ed7fccaa..bc686353 100644
--- a/tests/test-stats-site.c
+++ b/tests/test-stats-site.c
@@ -24,9 +24,14 @@
 
 #include "stats-test-util.h" // run_stats_test_with_option()
 #include <stdlib.h> // exit()
+#include "../defects4cpp.h"
 
 int main(void)
 {
+    switch (defects4cpp_test_index()) {
+        case 61:
 	run_stats_test_with_option("--stats-site");
+            break;
+    }
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-stats-tls.c b/tests/test-stats-tls.c
index 02116270..f1121aa3 100644
--- a/tests/test-stats-tls.c
+++ b/tests/test-stats-tls.c
@@ -23,9 +23,14 @@
 #include <config.h>
 
 #include "stats-test-util.h" // run_stats_test_with_option()
+#include "../defects4cpp.h"
 
 int main(void)
 {
+    switch (defects4cpp_test_index()) {
+        case 62:
 	run_stats_test_with_option("--stats-tls");
+            break;
+    }
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-timestamping.c b/tests/test-timestamping.c
index 13705aa1..66d91ac1 100644
--- a/tests/test-timestamping.c
+++ b/tests/test-timestamping.c
@@ -22,6 +22,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strlen()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 /* test for -N (--timestamping) and --no-if-modified-since */
 
@@ -66,6 +67,8 @@ int main(void)
 	};
 
 	int n_urls = countof(urls);
+    switch (defects4cpp_test_index()) {
+        case 63:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, n_urls,
@@ -390,6 +393,8 @@ int main(void)
 			{	urls[2].name + 1, urls[2].body, 1097310600 },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-unlink.c b/tests/test-unlink.c
index 575cb711..ae87b4a3 100644
--- a/tests/test-unlink.c
+++ b/tests/test-unlink.c
@@ -25,6 +25,7 @@
 
 #include <stdlib.h> // exit()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 int main(void)
 {
@@ -45,6 +46,8 @@ int main(void)
 		},
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 64:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -82,6 +85,8 @@ int main(void)
 			{ "original.html", urls[1].body },
 			{	NULL } },
 		0);
+            break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/tests/test-wget-1.c b/tests/test-wget-1.c
index 330c7978..1f9c875f 100644
--- a/tests/test-wget-1.c
+++ b/tests/test-wget-1.c
@@ -30,6 +30,7 @@
 #include <stdlib.h> // exit()
 #include <string.h> // strlen()
 #include "libtest.h"
+#include "../defects4cpp.h"
 
 static const char *mainpage = "\
 <html>\n\
@@ -150,6 +151,8 @@ int main(void)
 		}
 	};
 
+    switch (defects4cpp_test_index()) {
+        case 65:
 	// functions won't come back if an error occurs
 	wget_test_start_server(
 		WGET_TEST_RESPONSE_URLS, &urls, countof(urls),
@@ -589,6 +592,8 @@ int main(void)
 		WGET_TEST_EXPECTED_FILES, &(wget_test_file_t []) {
 			{	NULL } },
 		0);
+        break;
+    }
 
 	exit(EXIT_SUCCESS);
 }
diff --git a/unit-tests/test-cond.c b/unit-tests/test-cond.c
index 080e3f58..912e3b7d 100644
--- a/unit-tests/test-cond.c
+++ b/unit-tests/test-cond.c
@@ -21,6 +21,7 @@
 #include <unistd.h>
 
 #include <wget.h>
+#include "../defects4cpp.h"
 
 static int
 	cond_value = 0;
@@ -77,7 +78,11 @@ int main(void)
 	if (!wget_thread_support())
 		return 77;
 
+    switch (defects4cpp_test_index()) {
+        case 66:
 	test_cond();
+            break;
+    }
 
 	return 0;
 }
diff --git a/unit-tests/test-decompress.c b/unit-tests/test-decompress.c
index c6caddb1..e37d3738 100644
--- a/unit-tests/test-decompress.c
+++ b/unit-tests/test-decompress.c
@@ -22,6 +22,7 @@
 #include <string.h>
 
 #include <wget.h>
+#include "../defects4cpp.h"
 
 #define uncompressed_body "x"
 
@@ -92,6 +93,8 @@ static int get_decompressed(void *userdata, const char *data, size_t length)
 
 int main(WGET_GCC_UNUSED int argc, const char **argv)
 {
+    switch (defects4cpp_test_index()) {
+        case 67: {
 	// if VALGRIND testing is enabled, we have to call ourselves with valgrind checking
 	const char *valgrind = getenv("VALGRIND_TESTS");
 
@@ -145,5 +148,8 @@ int main(WGET_GCC_UNUSED int argc, const char **argv)
 	}
 
 	wget_info_printf("Summary: All %d tests passed\n", ok + failed);
+                }
+                break;
+    }
 	return 0;
 }
diff --git a/unit-tests/test-dl.c b/unit-tests/test-dl.c
index 41086019..2912312c 100644
--- a/unit-tests/test-dl.c
+++ b/unit-tests/test-dl.c
@@ -35,6 +35,7 @@
 #include <wget.h>
 
 #include "../src/wget_dl.h"
+#include "../defects4cpp.h"
 
 #define abortmsg(...) \
 do { \
@@ -292,6 +293,8 @@ int main(WGET_GCC_UNUSED int argc, char **argv)
 		return 77;
 	}
 
+    switch (defects4cpp_test_index()) {
+        case 68: {
 	// if VALGRIND testing is enabled, we have to call ourselves with
 	// valgrind checking
 	const char *valgrind = getenv("VALGRIND_TESTS");
@@ -319,6 +322,9 @@ int main(WGET_GCC_UNUSED int argc, char **argv)
 	run_test(test_linkage);
 
 	remove_object_dir();
+                }
+                break;
+    }
 
 	return 0;
 }
diff --git a/unit-tests/test-parse-html.c b/unit-tests/test-parse-html.c
index d5f79a13..83931bbc 100644
--- a/unit-tests/test-parse-html.c
+++ b/unit-tests/test-parse-html.c
@@ -41,6 +41,7 @@
 #include <wget.h>
 #include "../libwget/private.h"
 #include "../src/wget_options.h"
+#include "../defects4cpp.h"
 
 static int
 	ok,
@@ -194,6 +195,8 @@ int main(int argc, const char **argv)
 {
 	if (init(argc, argv) < 0) // allows us to test with options (e.g. with --debug)
 		return -1;
+    switch (defects4cpp_test_index()) {
+        case 69:
 	test_parse_buffer();
 	test_parse_files();
 
@@ -205,5 +208,7 @@ int main(int argc, const char **argv)
 	}
 
 	info_printf("Summary: All %d tests passed\n", ok + failed);
+            break;
+    }
 	return 0;
 }
diff --git a/unit-tests/test.c b/unit-tests/test.c
index 1cae71c8..dd767bf1 100644
--- a/unit-tests/test.c
+++ b/unit-tests/test.c
@@ -45,6 +45,7 @@
 
 #include "../src/wget_options.h"
 #include "../src/wget_log.h"
+#include "../defects4cpp.h"
 
 static int
 	ok,
@@ -2473,6 +2474,8 @@ static void test_free(void *ptr)
 
 int main(int argc, const char **argv)
 {
+    switch (defects4cpp_test_index()) {
+        case 70: {
 	// if VALGRIND testing is enabled, we have to call ourselves with valgrind checking
 	const char *valgrind = getenv("VALGRIND_TESTS");
 
@@ -2553,5 +2556,8 @@ int main(int argc, const char **argv)
 	}
 
 	info_printf("Summary: All %d tests passed\n", ok + failed);
+                }
+            break;
+    }
 	return 0;
 }
-- 
2.30.2

